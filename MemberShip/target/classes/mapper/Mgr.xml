<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="Mgr">
	
	<select id="deptList" parameterType="Mgr" resultType="Mgr">
		SELECT d_code,
			   d_name
		FROM DEPT
	</select>	
	<insert id="deptInput" parameterType="Mgr">
		MERGE INTO DEPT a 
		USING DUAL
		ON (a.d_code = #{d_code}
		    or a.d_name = #{d_name}
		    or #{d_code} NOT LIKE 'D%'
		   ) 
		WHEN NOT MATCHED THEN
			INSERT (a.d_code,a.d_name)
			VALUES (#{d_code},#{d_name})
	</insert>
	<select id="deptUpdateForm" parameterType="Mgr" resultType="Mgr" >
		SELECT d_code,
			   d_name
		FROM DEPT
		WHERE 1=1
		AND d_code = #{d_code}
		AND d_name = #{d_name}
	</select>
	<update id="deptUpdate" parameterType="Mgr">
		MERGE INTO DEPT A
		USING (SELECT D_CODE,D_NAME 
	           FROM DEPT
	           WHERE D_CODE = #{d_code}
          ) B
		ON ( A.d_code = B.D_CODE
		   ) 
   		WHEN MATCHED THEN
        	UPDATE SET A.d_name=#{d_name}
	</update>
	<delete id="deptDelete" parameterType="int">
		MERGE INTO DEPT A
			USING DUAL
			ON (A.D_CODE = #{d_code}
			AND (SELECT COUNT(*)
				 FROM MEMBER A, DEPT B
				 WHERE 1=1
				 AND A.D_CODE = B.D_CODE
				 AND A.D_CODE = #{d_code}) = 0
				 )
		WHEN MATCHED THEN 
			UPDATE SET A.D_NAME = '삭제'
			WHERE A.D_CODE = #{d_code}
			DELETE WHERE A.D_CODE = #{d_code}
			AND A.D_NAME = #{d_name}
		WHEN NOT MATCHED THEN
			INSERT (A.D_CODE,A.D_NAME)
			VALUES ('E99','ERROR')	
	</delete>
	<delete id="deptDeleteError" parameterType="int">
		DELETE 
		FROM DEPT
		WHERE D_CODE = 'E99'
		AND   D_NAME = 'ERROR'
	</delete>
	
	
	
	<select id="workList" parameterType="Mgr" resultType="Mgr">
		SELECT w_name,
			   w_except
		FROM WORK
	</select>
	<insert id="workInput" parameterType="Mgr">
		MERGE INTO WORK a 
		USING DUAL
		ON (a.W_NAME = #{w_name}
		    AND #{w_except} IN ('Y','N')
		   ) 
		WHEN NOT MATCHED THEN
			INSERT (a.w_name,a.w_except)
			VALUES (#{w_name},#{w_except})
	</insert>
	<select id="workUpdateForm" parameterType="Mgr" resultType="Mgr" >
		SELECT w_name,
			   w_except
		FROM WORK
		WHERE 1=1
		AND w_name = #{w_name}
		AND w_except = #{w_except}
	</select>
	<update id="workUpdate" parameterType="Mgr">
		UPDATE WORK SET W_NAME = '앱고지2'
		WHERE 1=1
		AND W_NAME = '앱고지'
		AND W_EXCEPT = 'Y'
	</update>
	<delete id="workDelete" parameterType="int">
		MERGE INTO WORK A
		  USING DUAL
		  ON (A.W_NAME = #{w_name})
		  WHEN MATCHED THEN
		    UPDATE SET A.W_EXCEPT = 'D'
		    WHERE A.W_NAME = #{w_name}
		    AND A.W_EXCEPT = #{w_except}
		    DELETE WHERE A.W_NAME = #{w_name}
		    AND A.W_EXCEPT = #{w_except}
		  WHEN NOT MATCHED THEN
		    INSERT(A.W_NAME,A.W_EXCEPT)
		    VALUES ('E99','ERROR')	
	</delete>
	<delete id="workDeleteError" parameterType="int">
		DELETE 
		FROM WORK
		WHERE W_NAME = 'E99'
		AND   W_EXCEPT = 'ERROR'
	</delete>
	
	
	
	
	
	<select id="siteList" parameterType="Mgr" resultType="Mgr">
		SELECT l_code,
			   l_name 
		FROM SITE
	</select>
	
	<select id="workPlaceList" parameterType="Mgr" resultType="Mgr">
		SELECT p_name,
			   p_addr
		FROM PLACE
	</select>
	
	<select id="memberList" parameterType="Mgr" resultType="Mgr">
		SELECT A.m_id,
               A.m_pw,
               A.m_name,
               A.d_code,
               A.m_position,
               A.m_gubun,
               A.m_joindate,
               A.m_leavedate,
               A.m_notice,
               B.d_name 
		FROM MEMBER A, DEPT B
		WHERE 1=1
    	AND A.D_CODE = B.D_CODE
	</select>
	
</mapper>